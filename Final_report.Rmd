---
title: "ST-661 - R for data Analytics Mini Project"
author: "Atikant Negi"
output: 
  html_document :
    code_folding: "hide"
---

```{r setup, include=FALSE}

library(pxR)
library(dplyr)
library(ggplot2)
library(ggpubr)

knitr::opts_chunk$set(echo = TRUE,fig.width = 11,fig.height = 8)
```


## Road accident casualties in Ireland{.tabset}
### Synopsis
__Objective__ : The objective of the project is to go through the road accident casualty data in Ireland from year 2005 - 2018 and answer some questions around it like what gender, age groups and road type users are more likely to encounter a casualty. What are the trends over the years around the injuries and people killed in road accidents. Predicting the outcomes of the near future events based on the previous data.

---

__Solution__ : Going through and analyzing the data using various pairs of explanatory variables we were able to draw conclusion. We used a variety of packages in R to draw the results.

---

__Insights__ : Various insights were drawn though the analysis such as:\

* Most no. of cases(9442) came in year 2009.
* Most no. of deaths (388) were reported in year 2005. 
* The no. of deaths have been gradually decreasing although the average number of cases (8017) reported remains approximately constant.
* The most number of casualties are seen in car drivers with its peak in 2009 and the lowest in 2013.
* 

---


### Packages Requirement

The following packages were used in the project:

* pxR
* ggplot2
* dplyr
* relaimpo
* Knitr
* Fitdistrplus
* car

```{r ,eval=FALSE,}
install.packages("ggplot2")
library(pxR)

library(ggplot2)
library(relaimpo)
library(car)
```


### Data Preparation {.tabset}

This sections consist of all the steps taken in getting the data analysis ready. The steps are explained in detail below.

#### Data Import

__Source of Data__ : https://statbank.cso.ie/px/pxeirestat/Database/eirestat/Road%20Safety%20Statistics/Road%20Safety%20Statistics_statbank.asp?SP=Road%20Safety%20Statistics&Planguage=0&ProductID=DB_RSA
\

__File Name__ : ROA16
\

__File Type__ : .Px
\

__Import command__ : 
\

```{r}
options(width = 120)
data<-as.data.frame(read.px("ROA16.px"))
head(data)
colnames(data)
dim(data)
```
__Data Cleaning__ : 
The data is flawless and needs no data cleaning. The values seems in line and there are no missing or invalid values in the data-set.


#### Data Preview

```{r}
options(width = 120)
head(data)
```

#### Data Description

There are 5 categorical data in the data-set i.e. 
\

* Statistics has 3 levels
```{r}
levels(data$Statistic)
```


* Years has 14 levels as:
```{r}
levels(data$Year)
```

* Road user type has 8 levels
```{r}
levels(data$Road.User.Type)
```

* Sex has 2 levels
```{r}
levels(data$Sex)
```

* age group has 13 levels
```{r}
levels(data$Age.Group)
```




### Data Anlaysis {.tabset}

#### General analysis

```{r}
# if we see the total no. of casualties over the years we can sum it as the below data set
d1<-subset(data,Statistic=="All Killed and Injured Casualties (Number)"
           &
             Road.User.Type=="All road users" 
           & 
             Age.Group=="All ages"
           & 
             Sex=="Male")%>%
  group_by(Year)

d2<-subset(data,Statistic=="All Killed and Injured Casualties (Number)"
           &
             Road.User.Type=="All road users" 
           & 
             Age.Group=="All ages"
           & 
             Sex=="Female")%>%
  group_by(Year)
total_casuality<-as_tibble(full_join(d1,d2,by=c("Year","Road.User.Type","Age.Group")))
total_casuality<-mutate(total_casuality,Total_vaue=total_casuality$value.x+total_casuality$value.y)


# if we see the total no. of injuries over the years we can sum it as the below data set
d_only_injured_male<-subset(data,Statistic=="Injured Cassualties (Number)"
           &
             Road.User.Type=="All road users" 
           & 
             Age.Group=="All ages"
           & 
             Sex=="Male")%>%
  group_by(Year)

d_only_injured_female<-subset(data,Statistic=="Injured Cassualties (Number)"
           &
             Road.User.Type=="All road users" 
           & 
             Age.Group=="All ages"
           & 
             Sex=="Female")%>%
  group_by(Year)
total_casuality_injured<-as_tibble(full_join(d_only_injured_male,d_only_injured_female,by=c("Year","Road.User.Type","Age.Group")))
total_casuality_injured<-mutate(total_casuality_injured,Total_vaue_injured=total_casuality_injured$value.x+total_casuality_injured$value.y)

  
normalized_data <-data.frame("year"=c(2005:2018),
                             "Road.User.Type"=rep("All road users",14),
                            "Injured"=total_casuality_injured$Total_vaue_injured,
                             "Killed_and_Injured"=total_casuality$Total_vaue,
                            "killed"=total_casuality$Total_vaue-total_casuality_injured$Total_vaue_injured)

normalized_data
# summary for casualties
summary(normalized_data)

# plot for the total casualties
plot(normalized_data$year,normalized_data$Killed_and_Injured,col="green",type="l",xlab="Year",ylab = "Numbers",ylim=c(0,10000))
lines(normalized_data$year,normalized_data$Injured,col="blue",type="l" )
lines(normalized_data$year,normalized_data$killed,col="red",type="l")

legend(2015, 10500, legend=c("Killed", "Injured","Total casualties"),
       col=c("red", "blue" ,"green"), lty=1, cex=0.75)


Male_female<-data.frame("year"=c(2005:2018),
                        "male_injured"=d_only_injured_male$value,
                        "female_injured"=d_only_injured_female$value,
                        "male_killed"=d1$value-d_only_injured_male$value,
                        "female_killed"=d2$value-d_only_injured_female$value
                          )
plot(Male_female$year,Male_female$female_injured,col="magenta",type="l",xlab="Year",ylab = "Numbers",ylim=c(0,6000))
lines(Male_female$year,Male_female$male_injured ,col="blue",type="l" )
lines(Male_female$year,Male_female$male_killed,col="cyan",type="l")
lines(Male_female$year,Male_female$female_killed,col="pink",type="l")

legend(2015, 6250, legend=c("Deceased Male", "Injured Male","Deceased Female", "Injured female"),
       col=c("cyan", "blue" ,"pink","magenta"), lty=1, cex=0.75)

```
\
\

#### Road user analysis
The following graph shows the number of deaths thoughout the years (2015-2018) for all the road user types.
```{r}
options(width = 80)
library(ggplot2)
totalRoadUserData=data[data$Statistic =='All Killed and Injured Casualties (Number)' & 
                    data$Road.User.Type != "All road users" & 
                    data$Road.User.Type != "All Car users", ]
totalRoadUserCasualty<-aggregate(totalRoadUserData$value, by=list(totalRoadUserData$Road.User.Type), FUN=sum)

ggplot(totalRoadUserCasualty,aes(x=Group.1,y=x,fill=Group.1))+geom_bar(stat="identity")+
  xlab("Type of road users")+ylab("no. of casualties")+theme_minimal()

```
\
\
This graph clearly shows that the no. of casualties for car drivers is more than any road user type category. \\\

---

```{r}
totalRoadUserkilled = data[data$Statistic !='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users", ]
ggplot(data=totalRoadUserkilled, aes(x=Road.User.Type, y=value, fill=Statistic), position = "fill") +
  geom_bar(stat="identity")+
  xlab("Type of road users")+ylab("no. of casualties")+theme_minimal()
```
\this graph shows the injury to kill number of the Road user type category .
\

---

We will dive more deeply in the stats comparing the gender of the people 
```{r}
car_driver<-data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"
                 & data$Age.Group != 'All ages', ]


car_driver<-transform(car_driver,Road.User.Type=ifelse(car_driver$Road.User.Type!="Car drivers","Others","Car drivers"))


ggplot(car_driver,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+facet_wrap(~Sex)+geom_hline(yintercept=.5)+coord_flip()
```
\ This plot shows the decreasing proportion of casualties in car drivers and  also comparing male , female car drivers.\

---

Proportion of Male and Female Car Driving Death Casualties Trend over 14 years.
```{r}
car_driver<-data[(data$Statistic =='Killed Casualties (Number)'|data$Statistic =='All Killed and Injured Casualties (Number)') & data$Road.User.Type == "Car drivers" & data$Age.Group == 'All ages'  , ]


car_driver<-transform(car_driver,Road.User.Type=ifelse(car_driver$Road.User.Type=="Car drivers" & car_driver$Statistic =='Killed Casualties (Number)',"Deceased drivers","Others"))


ggplot(car_driver,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+facet_wrap(~Sex)+geom_hline(yintercept=.95)+geom_hline(yintercept=.98)+coord_flip()
```
\ This plot shows the decreasing proportion of deaths in car drivers and  also comparing male , female car drivers.\


---

```{r}
options(width = 140)
library(ggplot2)
roadUser<-subset(data,Statistic=='All Killed and Injured Casualties (Number)' &
                
                  Road.User.Type!= "All road users" & 
                  Road.User.Type != "All Car users" &
                   Age.Group=="All ages")

roadUser_normalized_data<-data.frame("year"=roadUser$Year,"UserType"=roadUser$Road.User.Type,"Sex"=roadUser$Sex,"value"=roadUser$value)



ggplot(roadUser_normalized_data,aes(x=year,y=value,col=UserType,group=UserType))+
  geom_point()+
  geom_line()+
  facet_wrap(.~Sex)

```
\
\

#### Age group analysis

```{r}
AgeGroup<-subset(data,Statistic=='All Killed and Injured Casualties (Number)' &
                      Age.Group !="All ages" 
             & Road.User.Type=="All road users")



ggplot(AgeGroup,aes(x=Year,y=value,col=Age.Group,group=Age.Group))+
  geom_point()+
  geom_line()+
  facet_wrap(.~Sex)

```

\
\

---

Categorical Count of AGe Group WIse Casualties for 14 years.

```{r}
options(width = 2000)
AgeGroup_All = data[data$Statistic !='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users" & data$Age.Group != "All ages", ]
ggplot(data=AgeGroup_All, aes(x=Age.Group, y=value, fill=Statistic), position = "fill") +
  geom_bar(stat="identity")+coord_flip()
```

\
\

---

Analyzing behaviour of Top 4 Casualties Counts Age Groups Based on Car DRIVING CASUALTY PROPORTION AND KILLED Car DRIVING CASUALTY PROPORTION TRENDS.
```{r}
sub_cat1 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            (data$Age.Group == '15 - 17 years' | data$Age.Group == '18 - 20 years' | data$Age.Group == '21 - 24 years'), ]
sub_cat1<-transform(sub_cat1,Road.User.Type=ifelse(Road.User.Type!="Car drivers","All road users",as.character(Road.User.Type)))
sub_cat1$Road.User.Type=factor(sub_cat1$Road.User.Type)
sub_cat1 <- aggregate(value~Road.User.Type+Year, sub_cat1, sum)

sub_cat2 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  & data$Age.Group == '25 - 34 years' , ]
sub_cat2<-transform(sub_cat2,Road.User.Type=ifelse(Road.User.Type!="Car drivers","All road users",as.character(Road.User.Type)))
sub_cat2$Road.User.Type=factor(sub_cat2$Road.User.Type)

sub_cat3 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  & data$Age.Group == '35 - 44 years' , ]
sub_cat3<-transform(sub_cat3,Road.User.Type=ifelse(Road.User.Type!="Car drivers","All road users",as.character(Road.User.Type)))
sub_cat3$Road.User.Type=factor(sub_cat3$Road.User.Type)

sub_cat4 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  & data$Age.Group == '45 - 54 years' , ]
sub_cat4<-transform(sub_cat4,Road.User.Type=ifelse(Road.User.Type!="Car drivers","All road users",as.character(Road.User.Type)))
sub_cat4$Road.User.Type=factor(sub_cat4$Road.User.Type)


cat1<-ggplot(sub_cat1,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("15 - 24 Age group driver's casualties")+coord_flip()
cat2<-ggplot(sub_cat2,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("25 - 34 years Age group driver's casualties")+coord_flip()
cat3<-ggplot(sub_cat3,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("35 - 44 years Age group driver's casualties")+coord_flip()
cat4<-ggplot(sub_cat4,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("45 - 54 years Age group driver's casualties")+coord_flip()

figure <- ggarrange(cat1, cat2, cat3,cat4,
                     labels = c("A", "B", "C","D"),
                    ncol = 2, nrow = 2)
figure
```
\

---

Road User TYpe Total Casualties Proportion Trend
```{r}

sub_cat1 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat1<-transform(sub_cat1,Road.User.Type=ifelse(Road.User.Type!="Pedestrians","All road users",as.character(Road.User.Type)))
sub_cat1$Road.User.Type=factor(sub_cat1$Road.User.Type)
sub_cat1 <- aggregate(value~Road.User.Type+Year, sub_cat1, sum)
cat1<-ggplot(sub_cat1,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Pedestrians casualty proportion trend")+coord_flip()

sub_cat2 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat2<-transform(sub_cat2,Road.User.Type=ifelse(Road.User.Type!="Pedal cyclists","All road users",as.character(Road.User.Type)))
sub_cat2$Road.User.Type=factor(sub_cat2$Road.User.Type)
sub_cat2 <- aggregate(value~Road.User.Type+Year, sub_cat2, sum)
cat2<-ggplot(sub_cat2,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Pedal cyclists casualty proportion trend")+coord_flip()

sub_cat3 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat3<-transform(sub_cat3,Road.User.Type=ifelse(Road.User.Type!="Motor cyclists","All road users",as.character(Road.User.Type)))
sub_cat3$Road.User.Type=factor(sub_cat3$Road.User.Type)
sub_cat3 <- aggregate(value~Road.User.Type+Year, sub_cat3, sum)
cat3<-ggplot(sub_cat3,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Motor cyclists casualty proportion trend")+coord_flip()
  
sub_cat4 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat4<-transform(sub_cat4,Road.User.Type=ifelse(Road.User.Type!="Car drivers","All road users",as.character(Road.User.Type)))
sub_cat4$Road.User.Type=factor(sub_cat4$Road.User.Type)
sub_cat4 <- aggregate(value~Road.User.Type+Year, sub_cat4, sum)
cat4<-ggplot(sub_cat4,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Car drivers casualty proportion trend")+coord_flip()

sub_cat5 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat5<-transform(sub_cat5,Road.User.Type=ifelse(Road.User.Type!='Car passengers' ,"All road users",as.character(Road.User.Type)))
sub_cat5$Road.User.Type=factor(sub_cat5$Road.User.Type)
sub_cat5 <- aggregate(value~Road.User.Type+Year, sub_cat5, sum)
cat5<-ggplot(sub_cat5,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Car passengers casualty proportion trend")+coord_flip()

sub_cat6 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat6<-transform(sub_cat6,Road.User.Type=ifelse(Road.User.Type!="Other road users","All road users",as.character(Road.User.Type)))
sub_cat6$Road.User.Type=factor(sub_cat6$Road.User.Type)
sub_cat6 <- aggregate(value~Road.User.Type+Year, sub_cat6, sum)


cat6<-ggplot(sub_cat6,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Other road users casualty proportion trend")+coord_flip()

figure <- ggarrange(cat1, cat2, cat3,cat4,cat5,cat6,
                    ncol = 2, nrow = 3)
figure
```
\
\

---

Road User TYpe Total Casualties Proportion Trend
```{r}

sub_cat1 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat1<-transform(sub_cat1,Road.User.Type=ifelse(Road.User.Type!="Pedestrians","All road users",as.character(Road.User.Type)))
sub_cat1$Road.User.Type=factor(sub_cat1$Road.User.Type)
sub_cat1 <- aggregate(value~Road.User.Type+Year, sub_cat1, sum)
cat1<-ggplot(sub_cat1,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Pedestrians casualty proportion trend")+coord_flip()

sub_cat2 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat2<-transform(sub_cat2,Road.User.Type=ifelse(Road.User.Type!="Pedal cyclists","All road users",as.character(Road.User.Type)))
sub_cat2$Road.User.Type=factor(sub_cat2$Road.User.Type)
sub_cat2 <- aggregate(value~Road.User.Type+Year, sub_cat2, sum)
cat2<-ggplot(sub_cat2,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Pedal cyclists casualty proportion trend")+coord_flip()

sub_cat3 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat3<-transform(sub_cat3,Road.User.Type=ifelse(Road.User.Type!="Motor cyclists","All road users",as.character(Road.User.Type)))
sub_cat3$Road.User.Type=factor(sub_cat3$Road.User.Type)
sub_cat3 <- aggregate(value~Road.User.Type+Year, sub_cat3, sum)
cat3<-ggplot(sub_cat3,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Motor cyclists casualty proportion trend")+coord_flip()
  
sub_cat4 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat4<-transform(sub_cat4,Road.User.Type=ifelse(Road.User.Type!="Car drivers","All road users",as.character(Road.User.Type)))
sub_cat4$Road.User.Type=factor(sub_cat4$Road.User.Type)
sub_cat4 <- aggregate(value~Road.User.Type+Year, sub_cat4, sum)
cat4<-ggplot(sub_cat4,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Car drivers casualty proportion trend")+coord_flip()

sub_cat5 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat5<-transform(sub_cat5,Road.User.Type=ifelse(Road.User.Type!='Car passengers' ,"All road users",as.character(Road.User.Type)))
sub_cat5$Road.User.Type=factor(sub_cat5$Road.User.Type)
sub_cat5 <- aggregate(value~Road.User.Type+Year, sub_cat5, sum)
cat5<-ggplot(sub_cat5,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Car passengers casualty proportion trend")+coord_flip()

sub_cat6 = data[data$Statistic =='All Killed and Injured Casualties (Number)' & data$Road.User.Type != "All road users" & data$Road.User.Type != "All Car users"  &
            data$Age.Group == 'All ages' , ]
sub_cat6<-transform(sub_cat6,Road.User.Type=ifelse(Road.User.Type!="Other road users","All road users",as.character(Road.User.Type)))
sub_cat6$Road.User.Type=factor(sub_cat6$Road.User.Type)
sub_cat6 <- aggregate(value~Road.User.Type+Year, sub_cat6, sum)


cat6<-ggplot(sub_cat6,aes(x=Year,y=value,fill=Road.User.Type))+geom_bar(position="fill",stat="identity")+ggtitle("Other road users casualty proportion trend")+coord_flip()

figure <- ggarrange(cat1, cat2, cat3,cat4,cat5,cat6,
                    ncol = 2, nrow = 3)
figure
```


### Summary